<!DOCTYPE html>  
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Smart Gym - TV Display</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Global API URL
        const API_BASE_URL = 'http://localhost:5000';
        
        function updateTime() {
            const now = new Date();
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            document.getElementById('time').innerText = `${hours} : ${minutes}`;

            let greeting = "GOOD MORNING";
            if (hours >= 12 && hours < 18) greeting = "GOOD AFTERNOON";
            else if (hours >= 18) greeting = "GOOD EVENING";
            document.getElementById('greeting').innerText = greeting;

            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('date').innerText = now.toLocaleDateString('en-US', options).toUpperCase();
        }
        
        window.onload = function () {
            updateTime();
            fetchData();
            setInterval(updateTime, 60000); // Update time every minute
            setInterval(fetchData, 30000); // Refresh data every 30 seconds
        };

        async function fetchData() {
            try {
                // Show loading state only if we don't have data yet
                if (document.getElementById('tempValue').innerText === '--') {
                    document.querySelectorAll('.loading-overlay').forEach(el => {
                        el.classList.remove('hidden');
                    });
                }
                
                const response = await fetch(`${API_BASE_URL}/sensors/latest`, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`API responded with status: ${response.status}`);
                }
                
                const data = await response.json();
                
                // Update temperature
                document.getElementById('tempValue').innerText = data.temperature.toFixed(1);
                document.getElementById('tempUnit').innerText = '°C';
                
                // Update humidity
                document.getElementById('humidityValue').innerText = `${data.humidity.toFixed(0)}%`;
                
                // Update occupancy
                document.getElementById('currentOccupancy').innerText = data.peopleCount;
                
                // For demonstration, we'll set these values based on current occupancy
                document.getElementById('enteredCount').innerText = data.peopleCount + 5;
                document.getElementById('exitedCount').innerText = '5';

                const maxOccupancy = 50;
                const occupancyRatio = (data.peopleCount / maxOccupancy) * 100;
                document.getElementById('occupancyBar').style.width = `${occupancyRatio}%`;
                
                // Hide loading overlays
                document.querySelectorAll('.loading-overlay').forEach(el => {
                    el.classList.add('hidden');
                });
                
                // Show last updated time
                const lastUpdated = new Date();
                document.getElementById('lastUpdated').innerText = 
                    `Last updated: ${lastUpdated.getHours().toString().padStart(2, '0')}:${lastUpdated.getMinutes().toString().padStart(2, '0')}:${lastUpdated.getSeconds().toString().padStart(2, '0')}`;
            } catch (error) {
                console.error('Error fetching data:', error);
                useFallbackData();
            }
        }
        
        function useFallbackData() {
            document.getElementById('tempValue').innerText = '22.5';
            document.getElementById('tempUnit').innerText = '°C';
            document.getElementById('humidityValue').innerText = '45%';
            document.getElementById('currentOccupancy').innerText = '15';
            document.getElementById('enteredCount').innerText = '20';
            document.getElementById('exitedCount').innerText = '5';
            document.getElementById('occupancyBar').style.width = '30%';
            
            // Hide loading overlays
            document.querySelectorAll('.loading-overlay').forEach(el => {
                el.classList.add('hidden');
            });
            
            // Update last updated time
            const lastUpdated = new Date();
            document.getElementById('lastUpdated').innerText = 
                `Last updated: ${lastUpdated.getHours().toString().padStart(2, '0')}:${lastUpdated.getMinutes().toString().padStart(2, '0')}:${lastUpdated.getSeconds().toString().padStart(2, '0')}`;
        }
    </script>

    <style>
        body {
            background: url('https://i.ibb.co/Z1dTcNGx/Screenshot-2025-02-28-205107.png') no-repeat center center fixed;
            background-size: cover;
            font-family: Arial, sans-serif;
            overflow: hidden; /* Prevent scrolling on TV */
        }
        
        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(17, 24, 39, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 1rem;
            z-index: 10;
        }
        
        .loading-spinner {
            border: 6px solid rgba(59, 130, 246, 0.3);
            border-radius: 50%;
            border-top: 6px solid #3b82f6;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* TV-specific styles */
        .tv-container {
            padding: 2rem;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .tv-header {
            margin-bottom: 2rem;
        }
        
        .tv-content {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-around;
            flex-grow: 1;
        }
        
        .tv-box {
            background-color: rgba(17, 24, 39, 0.85);
            border-radius: 1rem;
            padding: 2rem;
            margin: 1rem;
            min-width: 300px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(59, 130, 246, 0.3);
            position: relative;
        }
    </style>
</head>
<body class="text-white">
    <div class="tv-container">
        <!-- Header: Logo, Greeting, Time & Date -->
        <div class="tv-header flex justify-between items-center">
            <div class="flex items-center">
                <img src="https://i.ibb.co/CpW0wPZG/Screenshot-2025-02-28-205044.png" alt="Logo" class="h-20 w-20 mr-4">
                <h1 class="text-5xl font-bold text-blue-400">SMART GYM</h1>
            </div>
            
            <div class="flex space-x-8 text-2xl">
                <h1 id="greeting" class="font-bold text-4xl uppercase">GOOD MORNING</h1>
                <p id="time" class="text-4xl font-bold">07 : 35</p>
                <h2 id="date" class="text-blue-400 text-3xl">SATURDAY MARCH 1, 2025</h2>
            </div>
        </div>
        
        <!-- Main Content: Temperature, Humidity, Occupancy -->
        <div class="tv-content">
            <!-- Temperature Box -->
            <div class="tv-box">
                <div class="loading-overlay hidden">
                    <div class="loading-spinner"></div>
                </div>
                <h3 class="text-blue-400 text-3xl mb-4">TEMPERATURE</h3>
                <p class="text-8xl font-bold text-center">
                    <span id="tempValue">--</span>
                    <span id="tempUnit" class="text-6xl">°C</span>
                </p>
            </div>

            <!-- Humidity Box -->
            <div class="tv-box">
                <div class="loading-overlay hidden">
                    <div class="loading-spinner"></div>
                </div>
                <h3 class="text-blue-400 text-3xl mb-4">HUMIDITY</h3>
                <p class="text-8xl font-bold text-center">
                    <span id="humidityValue">--%</span>
                </p>
            </div>

            <!-- Occupancy Box -->
            <div class="tv-box">
                <div class="loading-overlay hidden">
                    <div class="loading-spinner"></div>
                </div>
                <h3 class="text-blue-400 text-3xl mb-4">OCCUPANCY</h3>
                <div class="flex justify-between mt-4">
                    <div class="text-center">
                        <p class="text-7xl font-bold" id="currentOccupancy">--</p>
                        <p class="text-xl mt-2">Current</p>
                    </div>
                    <div class="text-center">
                        <p class="text-7xl font-bold">50</p>
                        <p class="text-xl mt-2">Maximum</p>
                    </div>
                </div>

                <!-- Dynamic progress bar -->
                <div class="w-full bg-gray-700 rounded-full h-4 mt-6 mb-6">
                    <div id="occupancyBar" class="bg-blue-400 h-4 rounded-full" style="width: 0%;"></div>
                </div>

                <div class="flex justify-between mt-4">
                    <div>
                        <p class="text-xl text-blue-400">Entered</p>
                        <p class="text-4xl" id="enteredCount">--</p>
                    </div>
                    <div>
                        <p class="text-xl text-blue-400">Exited</p>
                        <p class="text-4xl" id="exitedCount">--</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <div class="flex justify-between items-center mt-4 px-4">
            <div class="text-lg">
                <p class="text-blue-400 font-bold">LOMAKYLÄ RAKKARANTA</p>
                <p>📞 050 400 0373</p>
                <p>📍 Neljäs Avenjuu 3, 89400 Hyrynsalmi</p>
            </div>
            <div id="lastUpdated" class="text-gray-400 text-xl">
                Last updated: --:--:--
            </div>
        </div>
    </div>
</body>
</html>